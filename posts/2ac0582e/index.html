<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png"><link rel="icon" type="image/png" href="/img/site.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content="Jipeng Hao 的个人博客"><meta name="author" content="Martentite"><meta name="keywords" content="java, python, blog"><title>Chapter4 事务控制语句(TCL) - 山那边的小木屋</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/prism/1.21.0/themes/prism-okaidia.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_pf9vaxs7x7b.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="山那边的小木屋" type="application/atom+xml">
</head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>Jacob</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner intro-2" id="background" parallax="true" style="background:url(/img/road.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="container page-header text-center fade-in-up"><span class="h2" id="subtitle"></span><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> Martentite </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2020-11-12 23:50" pubdate>2020年11月12日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 2.3k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 27 分钟</span></div></div></div></div></div></header><main><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="container nopadding-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto" id="post"><h1 style="display:none">Chapter4 事务控制语句(TCL)</h1><div class="markdown-body" id="post-body"><h1 id="Chapter4-事务控制语句-TCL"><a href="#Chapter4-事务控制语句-TCL" class="headerlink" title="Chapter4 事务控制语句(TCL)"></a>Chapter4 事务控制语句(TCL)</h1><p>TCL即 Transaction Control Language 事务控制语言</p><h2 id="4-1-概念"><a href="#4-1-概念" class="headerlink" title="4.1 概念"></a>4.1 概念</h2><ol><li>事务定义：<br>一个或一组sql语句组成一个执行单元，这个执行单元要么全部执行，要么全部不执行。</li><li>事务的特性：ACID<ul><li>原子性：一个事务不可再分割，要么都执行要么都不执行</li><li>一致性：一个事务执行会使数据从一个一致状态切换到另外一个一致状态</li><li>隔离性：一个事务的执行不受其他事务的干扰</li><li>持久性：一个事务一旦提交，则会永久的改变数据库的数据.</li></ul></li><li>分类<ul><li>隐式事务：<br>事务没有明显的开启和结束的标记，如<code>insert</code>、<code>update</code>、<code>delete</code>语句</li><li>显式事务：<br>事务具有明显的开启和结束的标记（前提：必须先设置自动提交功能为禁用：<code>set autocommit=0;</code>）</li></ul></li></ol><h2 id="4-2-事物的创建"><a href="#4-2-事物的创建" class="headerlink" title="4.2 事物的创建"></a>4.2 事物的创建</h2><ol><li>创建步骤<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 步骤1：开启事务</span>
<span class="token keyword">set</span> autocommit<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">start</span> <span class="token keyword">transaction</span><span class="token punctuation">;</span> <span class="token comment"># 可选</span>
<span class="token comment"># 步骤2：编写事务中的sql语句(select insert update delete)</span>
<span class="token comment"># 语句1;</span>
<span class="token comment"># 语句2;</span>
<span class="token comment"># ...</span>
<span class="token comment"># 步骤3：结束事务</span>
<span class="token keyword">commit</span><span class="token punctuation">;</span> <span class="token comment"># 提交事务</span></code></pre></li><li>其他命令<ul><li><code>rollback;</code>：回滚事务，用在提交前</li><li><code>savepoint 节点名;</code> ：设置保存点，与回滚搭配使用<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">SAVEPOINT</span> a<span class="token punctuation">;</span><span class="token comment">#设置保存点</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">ROLLBACK</span> <span class="token keyword">TO</span> a<span class="token punctuation">;</span><span class="token comment">#回滚到保存点</span></code></pre></li></ul></li></ol><h2 id="4-3-事务的隔离"><a href="#4-3-事务的隔离" class="headerlink" title="4.3 事务的隔离"></a>4.3 事务的隔离</h2><ol><li><p>事务的并发问题</p><ul><li>脏读</li><li>不可重复读</li><li>幻读</li></ul></li><li><p>事务的隔离级别</p><ul><li><code>read uncommitted</code></li><li><code>read committed</code></li><li><code>repeatable read</code></li><li><code>serializable</code></li></ul><table><thead><tr><th align="center">隔离级别</th><th align="center">脏读</th><th align="center">不可重复读</th><th align="center">幻读</th></tr></thead><tbody><tr><td align="center">read uncommitted：</td><td align="center">√</td><td align="center">√</td><td align="center">√</td></tr><tr><td align="center">read committed：</td><td align="center">×</td><td align="center">√</td><td align="center">√</td></tr><tr><td align="center">repeatable read：</td><td align="center">×</td><td align="center">×</td><td align="center">√</td></tr><tr><td align="center">serializable</td><td align="center">×</td><td align="center">×</td><td align="center">×</td></tr></tbody></table></li><li><p>说明</p><ul><li>mysql中默认 第三个隔离级别 repeatable read</li><li>oracle中默认第二个隔离级别 read committed</li></ul></li><li><p>常用命令</p><ul><li><code>select @@tx_isolation;</code>：查看隔离级别 (在MySQL8中，tx_isolation变量已修改为transaction_isolation)</li><li><code>set session|global transaction isolation level 隔离级别;</code>：设置隔离级别</li></ul></li></ol><h1 id="Chapter5-视图"><a href="#Chapter5-视图" class="headerlink" title="Chapter5 视图"></a>Chapter5 视图</h1><h2 id="5-1-概念"><a href="#5-1-概念" class="headerlink" title="5.1 概念"></a>5.1 概念</h2><ol><li>虚拟表，和普通表一样使用</li><li>mysql5.1版本出现的新特性，是通过表动态生成的数据<h2 id="5-2-使用视图"><a href="#5-2-使用视图" class="headerlink" title="5.2 使用视图"></a>5.2 使用视图</h2></li><li>创建视图<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">view</span> 视图名
<span class="token keyword">as</span>
查询语句<span class="token punctuation">;</span></code></pre></li><li>修改视图<ol><li>方式一<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token operator">or</span> <span class="token keyword">replace</span> <span class="token keyword">view</span>  视图名
<span class="token keyword">as</span>
查询语句<span class="token punctuation">;</span></code></pre></li><li>方式二<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">view</span> 视图名
<span class="token keyword">as</span> 
查询语句<span class="token punctuation">;</span></code></pre></li></ol></li><li>删除视图<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">drop</span> <span class="token keyword">view</span> 视图名<span class="token punctuation">,</span>视图名<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span></code></pre></li><li>查看视图<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DESC</span> myv3<span class="token punctuation">;</span>

<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> myv3<span class="token punctuation">;</span></code></pre></li><li>视图的更新<ol><li>插入数据<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> 视图名 <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></li><li>修改数据<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">UPDATE</span> 视图名 <span class="token keyword">SET</span> 列名<span class="token operator">=</span></code></pre></li><li>删除数据<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> 视图名 <span class="token keyword">WHERE</span> 条件<span class="token punctuation">;</span></code></pre></li></ol></li><li>不允许更新的视图<ol><li>包含以下关键字的sql语句：分组函数、distinct、group by、having、union或者union all</li><li>常量视图</li><li>Select中包含子查询</li><li>join（联结表）</li><li>from一个不能更新的视图</li><li>where子句的子查询引用了from子句中的表</li></ol></li><li><code>delete</code>与<code>truncate</code><ul><li>delete可以回滚</li><li>truncate不能回滚</li></ul></li></ol><h1 id="Chapter6-变量"><a href="#Chapter6-变量" class="headerlink" title="Chapter6 变量"></a>Chapter6 变量</h1><h2 id="6-1-分类"><a href="#6-1-分类" class="headerlink" title="6.1 分类"></a>6.1 分类</h2><ol><li>系统变量：<ul><li>全局变量</li><li>会话变量</li></ul></li><li>自定义变量：<ul><li>用户变量</li><li>局部变量</li></ul></li><li>全局变量需要添加<code>global</code>关键字，会话变量需要添加<code>session</code>关键字，如果不写，默认会话级别</li></ol><h2 id="6-2-使用"><a href="#6-2-使用" class="headerlink" title="6.2 使用"></a>6.2 使用</h2><h3 id="6-2-1-系统变量"><a href="#6-2-1-系统变量" class="headerlink" title="6.2.1 系统变量"></a>6.2.1 系统变量</h3><ol><li><p>常用命令</p><ol><li>查看所有系统变量<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> <span class="token keyword">global</span><span class="token operator">|</span><span class="token keyword">session</span> variables<span class="token punctuation">;</span></code></pre></li><li>查看满足条件的部分系统变量<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> <span class="token keyword">global</span><span class="token operator">|</span><span class="token keyword">session</span> variables <span class="token operator">like</span> <span class="token string">'%char%'</span><span class="token punctuation">;</span></code></pre></li><li>查看指定的系统变量的值<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> @<span class="token variable">@global</span><span class="token operator">|</span><span class="token keyword">session</span><span class="token punctuation">.</span>系统变量名<span class="token punctuation">;</span></code></pre></li><li>为某个系统变量赋值<ul><li>方式一：<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">set</span> <span class="token keyword">global</span><span class="token operator">|</span><span class="token keyword">session</span> 系统变量名<span class="token operator">=</span>值<span class="token punctuation">;</span></code></pre></li><li>方式二：<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">set</span> @<span class="token variable">@global</span><span class="token operator">|</span><span class="token keyword">session</span><span class="token punctuation">.</span>系统变量名<span class="token operator">=</span>值<span class="token punctuation">;</span></code></pre></li></ul></li></ol></li><li><p>全局变量<br>作用域：针对于所有会话（连接）有效，但不能跨重启</p><ul><li>查看所有全局变量<pre class="language-sql" data-language="sql"><code class="language-sql">      <span class="token keyword">SHOW</span> <span class="token keyword">GLOBAL</span> VARIABLES<span class="token punctuation">;</span>
   <span class="token operator">*</span> 查看满足条件的部分系统变量
      <span class="token punctuation">`</span><span class="token punctuation">`</span><span class="token punctuation">`</span><span class="token keyword">sql</span>
      <span class="token keyword">SHOW</span> <span class="token keyword">GLOBAL</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'%char%'</span><span class="token punctuation">;</span>
   <span class="token operator">*</span> 查看指定的系统变量的值
      <span class="token punctuation">`</span><span class="token punctuation">`</span><span class="token punctuation">`</span><span class="token keyword">sql</span>
      <span class="token keyword">SELECT</span> @<span class="token variable">@global.autocommit</span><span class="token punctuation">;</span>
   <span class="token operator">*</span> 为某个系统变量赋值
      <span class="token punctuation">`</span><span class="token punctuation">`</span><span class="token punctuation">`</span><span class="token keyword">sql</span>
      <span class="token keyword">SET</span> @<span class="token variable">@global.autocommit</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> autocommit<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token number">3.</span> 会话变量  
   作用域：针对于当前会话（连接）有效
   <span class="token operator">*</span> 查看所有会话变量
      <span class="token punctuation">`</span><span class="token punctuation">`</span><span class="token punctuation">`</span><span class="token keyword">sql</span>
      <span class="token keyword">SHOW</span> <span class="token keyword">SESSION</span> VARIABLES<span class="token punctuation">;</span>
   <span class="token operator">*</span> 查看满足条件的部分会话变量
      <span class="token punctuation">`</span><span class="token punctuation">`</span><span class="token punctuation">`</span><span class="token keyword">sql</span>
      <span class="token keyword">SHOW</span> <span class="token keyword">SESSION</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'%char%'</span><span class="token punctuation">;</span>
   <span class="token operator">*</span> 查看指定的会话变量的值
      <span class="token punctuation">`</span><span class="token punctuation">`</span><span class="token punctuation">`</span><span class="token keyword">sql</span>
      <span class="token keyword">SELECT</span> @<span class="token variable">@autocommit</span><span class="token punctuation">;</span>
      <span class="token keyword">SELECT</span> @<span class="token variable">@session.tx_isolation</span><span class="token punctuation">;</span>
   <span class="token operator">*</span> 为某个会话变量赋值
      <span class="token punctuation">`</span><span class="token punctuation">`</span><span class="token punctuation">`</span><span class="token keyword">sql</span>
      <span class="token keyword">SET</span> @<span class="token variable">@session.tx_isolation</span><span class="token operator">=</span><span class="token string">'read-uncommitted'</span><span class="token punctuation">;</span>
      <span class="token keyword">SET</span> <span class="token keyword">SESSION</span> tx_isolation<span class="token operator">=</span><span class="token string">'read-committed'</span><span class="token punctuation">;</span></code></pre></li></ul></li></ol><h3 id="6-2-2-自定义变量"><a href="#6-2-2-自定义变量" class="headerlink" title="6.2.2 自定义变量"></a>6.2.2 自定义变量</h3><ol><li>使用步骤：<ol><li>声明</li><li>赋值</li><li>使用（查看、比较、运算等）</li></ol></li><li>用户变量<br>作用域：针对于当前会话（连接）有效，作用域同于会话变量<ul><li>声明并初始化<pre class="language-sql" data-language="sql"><code class="language-sql">   <span class="token keyword">SET</span> @变量名<span class="token operator">=</span>值<span class="token punctuation">;</span>
   <span class="token keyword">SET</span> @变量名:<span class="token operator">=</span>值<span class="token punctuation">;</span>
   <span class="token keyword">SELECT</span> @变量名:<span class="token operator">=</span>值<span class="token punctuation">;</span>

<span class="token operator">*</span> 赋值（更新变量的值）
   <span class="token punctuation">`</span><span class="token punctuation">`</span><span class="token punctuation">`</span><span class="token keyword">sql</span>
   <span class="token comment">#方式一：</span>
   <span class="token keyword">SET</span> @变量名<span class="token operator">=</span>值<span class="token punctuation">;</span>
   <span class="token keyword">SET</span> @变量名:<span class="token operator">=</span>值<span class="token punctuation">;</span>
   <span class="token keyword">SELECT</span> @变量名:<span class="token operator">=</span>值<span class="token punctuation">;</span>

   <span class="token comment">#方式二：</span>
   <span class="token keyword">SELECT</span> 字段 <span class="token keyword">INTO</span> @变量名
   <span class="token keyword">FROM</span> 表<span class="token punctuation">;</span></code></pre></li><li>使用（查看变量的值）<pre class="language-sql" data-language="sql"><code class="language-sql">      <span class="token keyword">SELECT</span> @变量名<span class="token punctuation">;</span>
<span class="token number">3.</span> 局部变量    
   作用域：仅仅在定义它的<span class="token keyword">begin</span> <span class="token keyword">end</span>块中有效，应用在 <span class="token keyword">begin</span> <span class="token keyword">end</span>中的第一句话
   <span class="token operator">*</span> 声明
      <span class="token punctuation">`</span><span class="token punctuation">`</span><span class="token punctuation">`</span><span class="token keyword">sql</span>
      <span class="token keyword">DECLARE</span> 变量名 类型<span class="token punctuation">;</span>
      <span class="token keyword">DECLARE</span> 变量名 类型 <span class="token punctuation">[</span><span class="token keyword">DEFAULT</span> 值<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre></li><li>赋值（更新变量的值）<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment">#方式一：</span>
   <span class="token keyword">SET</span> 局部变量名<span class="token operator">=</span>值<span class="token punctuation">;</span>
   <span class="token keyword">SET</span> 局部变量名:<span class="token operator">=</span>值<span class="token punctuation">;</span>
   <span class="token keyword">SELECT</span> 局部变量名:<span class="token operator">=</span>值<span class="token punctuation">;</span>
<span class="token comment">#方式二：</span>
   <span class="token keyword">SELECT</span> 字段 <span class="token keyword">INTO</span> 变量名
   <span class="token keyword">FROM</span> 表<span class="token punctuation">;</span></code></pre></li><li>使用（查看变量的值）<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> 局部变量名<span class="token punctuation">;</span></code></pre></li></ul></li></ol><h1 id="Chapter7-存储过程"><a href="#Chapter7-存储过程" class="headerlink" title="Chapter7 存储过程"></a>Chapter7 存储过程</h1><h2 id="7-1-概念"><a href="#7-1-概念" class="headerlink" title="7.1 概念"></a>7.1 概念</h2><ol><li>定义<br>一组预先编译好的SQL语句的集合，理解成批处理语句</li><li>优点<ol><li>提高代码的重用性</li><li>简化操作</li><li>减少了编译次数并且减少了和数据库服务器的连接次数，提高了效率</li></ol></li></ol><h2 id="7-2-使用"><a href="#7-2-使用" class="headerlink" title="7.2 使用"></a>7.2 使用</h2><h3 id="7-2-1-创建语法"><a href="#7-2-1-创建语法" class="headerlink" title="7.2.1 创建语法"></a>7.2.1 创建语法</h3><ol><li><p>定义</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> 存储过程名<span class="token punctuation">(</span>参数列表<span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>

   存储过程体（一组合法的<span class="token keyword">SQL</span>语句）
<span class="token keyword">END</span></code></pre></li><li><p>说明</p><ol><li><p>参数列表包含三部分</p><pre class="language-sql" data-language="sql"><code class="language-sql">参数模式  参数名  参数类型
<span class="token comment"># 举例：</span>
<span class="token operator">in</span> stuname <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span></code></pre></li><li><p>参数模式：</p><ul><li><code>in</code>：该参数可以作为输入，也就是该参数需要调用方传入值</li><li><code>out</code>：该参数可以作为输出，也就是该参数可以作为返回值</li><li><code>inout</code>：该参数既可以作为输入又可以作为输出，也就是该参数既需要传入值，又可以返回值</li></ul></li><li><p>如果存储过程体仅仅只有一句话，<code>begin</code> <code>end</code>可以省略<br>存储过程体中的每条sql语句的结尾要求必须加分号, 存储过程的结尾可以使用 <code>delimiter</code> 重新设置</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">delimiter</span> 结束标记
<span class="token comment"># 例：</span>
<span class="token keyword">delimiter</span> $</code></pre></li></ol></li><li><p>调用</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CALL</span> 存储过程名<span class="token punctuation">(</span>实参列表<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li></ol><h3 id="7-2-2-删除与查看存储过程"><a href="#7-2-2-删除与查看存储过程" class="headerlink" title="7.2.2 删除与查看存储过程"></a>7.2.2 删除与查看存储过程</h3><ol><li>删除<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">drop</span> <span class="token keyword">procedure</span> 存储过程名<span class="token punctuation">;</span></code></pre></li><li>查看<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span>  存储过程名<span class="token punctuation">;</span></code></pre></li></ol><h3 id="7-2-3-代码示例"><a href="#7-2-3-代码示例" class="headerlink" title="7.2.3 代码示例"></a>7.2.3 代码示例</h3><ol><li><p>根据输入的女神名，返回对应的男神名和魅力值</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> myp7<span class="token punctuation">(</span><span class="token operator">IN</span> beautyName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">OUT</span> boyName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">OUT</span> usercp <span class="token keyword">INT</span><span class="token punctuation">)</span> 
<span class="token keyword">BEGIN</span>
   <span class="token keyword">SELECT</span> boys<span class="token punctuation">.</span>boyname <span class="token punctuation">,</span>boys<span class="token punctuation">.</span>usercp <span class="token keyword">INTO</span> boyname<span class="token punctuation">,</span>usercp
   <span class="token keyword">FROM</span> boys 
   <span class="token keyword">RIGHT</span> <span class="token keyword">JOIN</span>
   beauty b <span class="token keyword">ON</span> b<span class="token punctuation">.</span>boyfriend_id <span class="token operator">=</span> boys<span class="token punctuation">.</span>id
   <span class="token keyword">WHERE</span> b<span class="token punctuation">.</span>name<span class="token operator">=</span>beautyName <span class="token punctuation">;</span>
   
<span class="token keyword">END</span> $</code></pre><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment">#调用</span>
<span class="token keyword">CALL</span> myp7<span class="token punctuation">(</span><span class="token string">'小昭'</span><span class="token punctuation">,</span><span class="token variable">@name</span><span class="token punctuation">,</span><span class="token variable">@cp</span><span class="token punctuation">)</span> $
<span class="token keyword">SELECT</span> <span class="token variable">@name</span><span class="token punctuation">,</span><span class="token variable">@cp</span> $</code></pre></li><li><p>传入a和b两个值，最终a和b都翻倍并返回</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> myp8<span class="token punctuation">(</span><span class="token keyword">INOUT</span> a <span class="token keyword">INT</span> <span class="token punctuation">,</span><span class="token keyword">INOUT</span> b <span class="token keyword">INT</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
   <span class="token keyword">SET</span> a<span class="token operator">=</span>a<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">;</span>
   <span class="token keyword">SET</span> b<span class="token operator">=</span>b<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> $

<span class="token comment">#调用</span>
<span class="token keyword">SET</span> <span class="token variable">@m</span><span class="token operator">=</span><span class="token number">10</span>$
<span class="token keyword">SET</span> <span class="token variable">@n</span><span class="token operator">=</span><span class="token number">20</span>$
<span class="token keyword">CALL</span> myp8<span class="token punctuation">(</span><span class="token variable">@m</span><span class="token punctuation">,</span><span class="token variable">@n</span><span class="token punctuation">)</span> $
<span class="token keyword">SELECT</span> <span class="token variable">@m</span><span class="token punctuation">,</span><span class="token variable">@n</span> $</code></pre></li></ol><h1 id="Chapter8-函数"><a href="#Chapter8-函数" class="headerlink" title="Chapter8 函数"></a>Chapter8 函数</h1><h2 id="8-1-概述"><a href="#8-1-概述" class="headerlink" title="8.1 概述"></a>8.1 概述</h2><ol><li>与存储过程区别<ul><li>存储过程：可以有0个返回，也可以有多个返回，适合做批量插入、批量更新</li><li>函数：有且仅有1 个返回，适合做处理数据后返回一个结果</li></ul></li></ol><h2 id="8-2-语法"><a href="#8-2-语法" class="headerlink" title="8.2 语法"></a>8.2 语法</h2><ol><li>创建语法<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> 函数名<span class="token punctuation">(</span>参数列表<span class="token punctuation">)</span> <span class="token keyword">RETURNS</span> 返回类型
<span class="token keyword">BEGIN</span>
   函数体
<span class="token keyword">END</span></code></pre><ul><li>参数列表：参数名 参数类型</li><li>函数体：必须有return语句</li><li>函数体中仅有一句话，则可以省略begin end</li><li>使用 delimiter语句设置结束标记</li></ul></li><li>调用语法<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> 函数名<span class="token punctuation">(</span>参数列表<span class="token punctuation">)</span></code></pre></li><li>查看函数<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> myf3<span class="token punctuation">;</span></code></pre></li><li>删除函数<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">FUNCTION</span> myf3<span class="token punctuation">;</span></code></pre></li></ol><h2 id="8-3-代码示例"><a href="#8-3-代码示例" class="headerlink" title="8.3 代码示例"></a>8.3 代码示例</h2><ol><li>根据员工名，返回它的工资<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DELIMITER</span> $
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> myf2<span class="token punctuation">(</span>empName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">RETURNS</span> <span class="token keyword">DOUBLE</span>
<span class="token keyword">BEGIN</span>
   <span class="token keyword">SET</span> <span class="token variable">@sal</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">#定义用户变量 </span>
   <span class="token keyword">SELECT</span> salary <span class="token keyword">INTO</span> <span class="token variable">@sal</span>   <span class="token comment">#赋值</span>
   <span class="token keyword">FROM</span> employees
   <span class="token keyword">WHERE</span> last_name <span class="token operator">=</span> empName<span class="token punctuation">;</span>
   
   <span class="token keyword">RETURN</span> <span class="token variable">@sal</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> $

<span class="token keyword">SELECT</span> myf2<span class="token punctuation">(</span><span class="token string">'k_ing'</span><span class="token punctuation">)</span> $</code></pre></li><li>根据部门名，返回该部门的平均工资<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> myf3<span class="token punctuation">(</span>deptName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">RETURNS</span> <span class="token keyword">DOUBLE</span>
<span class="token keyword">BEGIN</span>
   <span class="token keyword">DECLARE</span> sal <span class="token keyword">DOUBLE</span> <span class="token punctuation">;</span>
   <span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">INTO</span> sal
   <span class="token keyword">FROM</span> employees e
   <span class="token keyword">JOIN</span> departments d <span class="token keyword">ON</span> e<span class="token punctuation">.</span>department_id <span class="token operator">=</span> d<span class="token punctuation">.</span>department_id
   <span class="token keyword">WHERE</span> d<span class="token punctuation">.</span>department_name<span class="token operator">=</span>deptName<span class="token punctuation">;</span>
   <span class="token keyword">RETURN</span> sal<span class="token punctuation">;</span>
<span class="token keyword">END</span> $

<span class="token keyword">SELECT</span> myf3<span class="token punctuation">(</span><span class="token string">'IT'</span><span class="token punctuation">)</span>$</code></pre></li></ol><h1 id="Chapter9-流程控制结构"><a href="#Chapter9-流程控制结构" class="headerlink" title="Chapter9 流程控制结构"></a>Chapter9 流程控制结构</h1><h2 id="9-1-分支结构"><a href="#9-1-分支结构" class="headerlink" title="9.1 分支结构"></a>9.1 分支结构</h2><ol><li><code>if</code> 函数<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">IF</span><span class="token punctuation">(</span>表达式<span class="token number">1</span><span class="token punctuation">,</span> 表达式<span class="token number">2</span><span class="token punctuation">,</span>表达式<span class="token number">3</span> <span class="token punctuation">)</span></code></pre>表达式1成立则执行2，否则执行3</li><li>case结构<ul><li>类似Java中的switch语句<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">case</span> 变量或表达式
<span class="token keyword">when</span> 值<span class="token number">1</span> <span class="token keyword">then</span> 语句<span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">when</span> 值<span class="token number">2</span> <span class="token keyword">then</span> 语句<span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">else</span> 语句n<span class="token punctuation">;</span>
<span class="token keyword">end</span> </code></pre></li><li>类似Java中的多重IF语句，区间判断<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">case</span> 
<span class="token keyword">when</span> 条件<span class="token number">1</span> <span class="token keyword">then</span> 语句<span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">when</span> 条件<span class="token number">2</span> <span class="token keyword">then</span> 语句<span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">else</span> 语句n<span class="token punctuation">;</span>
<span class="token keyword">end</span> </code></pre></li></ul></li><li><code>if</code> 结构<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">if</span> 条件<span class="token number">1</span> <span class="token keyword">then</span> 语句<span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">elseif</span> 条件<span class="token number">2</span> <span class="token keyword">then</span> 语句<span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">else</span> 语句n<span class="token punctuation">;</span>
<span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span></code></pre><ul><li>功能：类似于多重if</li><li>只能应用在<code>begin</code> <code>end</code> 中</li></ul></li></ol><h2 id="9-2-循环结构"><a href="#9-2-循环结构" class="headerlink" title="9.2 循环结构"></a>9.2 循环结构</h2><ol><li>while<pre class="language-sql" data-language="sql"><code class="language-sql">  <span class="token punctuation">[</span>标签<span class="token punctuation">]</span> <span class="token keyword">while</span> 循环条件 <span class="token keyword">do</span>
循环体<span class="token punctuation">;</span>
  <span class="token keyword">end</span> <span class="token keyword">while</span> <span class="token punctuation">[</span>标签<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre></li><li>loop<pre class="language-sql" data-language="sql"><code class="language-sql">  <span class="token punctuation">[</span>标签:<span class="token punctuation">]</span> <span class="token keyword">loop</span>
循环体<span class="token punctuation">;</span>
  <span class="token keyword">end</span> <span class="token keyword">loop</span> <span class="token punctuation">[</span>标签<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><code>loop</code>可以用来模拟简单的死循环</li><li>repeat<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token punctuation">[</span>标签:<span class="token punctuation">]</span> <span class="token keyword">repeat</span>
 <span class="token comment"># 循环体;</span>
until 结束循环的条件
<span class="token keyword">end</span> <span class="token keyword">repeat</span> <span class="token punctuation">[</span>标签<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre></li><li>循环控制：<ul><li><code>iterate</code>类似于 <code>continue</code>，继续，结束本次循环，继续下一次</li><li><code>leave</code> 类似于 <code>break</code>，跳出当前所在的循环</li></ul></li></ol></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/MySQL/">MySQL</a> <a class="hover-with-bg" href="/categories/MySQL/MySQL%E5%9F%BA%E7%A1%80/">MySQL基础</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/mysql/">mysql</a></div></div><div class="post-prevnext row"><article class="post-prev col-6"><a href="/posts/35d81cec/"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Chapter15 JDK8新特性</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/posts/a526b75/"><span class="hidden-mobile">Chapter3 数据定义语言(DDL)</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments"><div class="disqus" style="width:100%"><div id="disqus_thread"></div><script>function loadDisqus(){addCssLink("https://cdn.jsdelivr.net/npm/disqusjs@1.0/dist/disqusjs.css"),addScript("https://cdn.jsdelivr.net/npm/disqusjs@1.0/dist/disqus.js",(function(){new DisqusJS({shortname:"Jacob",apikey:""})}))}waitElementVisible("disqus_thread",loadDisqus)</script><noscript>Please enable JavaScript to view the <a target="_blank" href="https://disqus.com/?ref_noscript" rel="nofollow noopener noopener">comments powered by Disqus.</a></noscript></div></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div id="tocbot"></div></div></div></div></div></main><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><footer class="mt-5"><div class="text-center py-3"><div><a href="https://github.com/" target="_blank" rel="nofollow noopener"><span>Github</span></a> <i class="iconfont icon-love"></i> <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a></div><div><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">总访问量 <span id="busuanzi_value_site_pv"></span> 次 </span><span id="busuanzi_container_site_uv" style="display:none">总访客数 <span id="busuanzi_value_site_uv"></span> 人</span></div></div><div><span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span><script>var now=new Date;function createtime(){var n=new Date("10/06/2020 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="本站安全运行&nbsp"+dnum+"&nbsp天",document.getElementById("times").innerHTML=hnum+"&nbsp小时&nbsp"+mnum+"&nbsp分&nbsp"+snum+"&nbsp秒"}setInterval("createtime()",250)</script></div></div></footer><script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script><script src="/js/debouncer.js"></script><script src="/js/main.js"></script><script src="/js/lazyload.js"></script><script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script src="/js/clipboard-use.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js"></script><script>$(document).ready((function(){var t=$("#board-ctn").offset().top;tocbot.init({tocSelector:"#tocbot",contentSelector:"#post-body",headingSelector:"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:3,scrollSmooth:!0,headingsOffset:-t}),$(".toc-list-item").length>0&&$("#toc").css("visibility","visible")}))</script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>var typed=new Typed("#subtitle",{strings:["  ","Chapter4 事务控制语句(TCL)&nbsp;"],cursorChar:"|",typeSpeed:90,loop:!0});typed.stop(),$(document).ready((function(){$(".typed-cursor").addClass("h2"),typed.start()}))</script><script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script><script>anchors.options={placement:"right",visible:"hover"};var el="h1,h2,h3,h4,h5,h6".split(","),res=[];for(item of el)res.push(".markdown-body > "+item);anchors.add(res.join(", "))</script><script src="/js/local-search.js"></script><script>var path="/local-search.xml",inputArea=document.querySelector("#local-search-input");inputArea.onclick=function(){searchFunc(path,"local-search-input","local-search-result"),this.onclick=null}</script><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><script>$("#post img:not(.no-zoom img, img[no-zoom]), img[zoom]").each((function(){var t=document.createElement("a");$(t).attr("data-fancybox","images"),$(t).attr("href",$(this).attr("src")),$(this).wrap(t)}))</script></body></html>