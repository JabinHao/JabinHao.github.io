<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png"><link rel="icon" type="image/png" href="/img/site.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content="Jipeng Hao 的个人博客"><meta name="author" content="Martentite"><meta name="keywords" content="java, python, blog"><title>Chapter8 RabbitMQ 集群 - 山那边的小木屋</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/prism/1.21.0/themes/prism-okaidia.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_pf9vaxs7x7b.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="山那边的小木屋" type="application/atom+xml">
</head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>Jacob</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner intro-2" id="background" parallax="true" style="background:url(/img/banner/doggie.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="container page-header text-center fade-in-up"><span class="h2" id="subtitle"></span><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> Martentite </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2021-06-22 23:46" pubdate>2021年6月22日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 2k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 25 分钟</span></div></div></div></div></div></header><main><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="container nopadding-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto" id="post"><h1 style="display:none">Chapter8 RabbitMQ 集群</h1><div class="markdown-body" id="post-body"><h2 id="8-1-搭建"><a href="#8-1-搭建" class="headerlink" title="8.1 搭建"></a>8.1 搭建</h2><h3 id="8-1-1-搭建集群"><a href="#8-1-1-搭建集群" class="headerlink" title="8.1.1 搭建集群"></a>8.1.1 搭建集群</h3><ol><li><p>修改主机名</p><pre class="language-sh" data-language="sh"><code class="language-sh">vim &#x2F;etc&#x2F;hostname
reboot # 重启</code></pre><p>修改主机名会导致RabbitMQ丢失之前的数据，包括创建的用户</p></li><li><p>配置各个节点的 hosts 文件，让各个节点都能互相识别对方</p><pre class="language-none"><code class="language-none"># &#x2F;etc&#x2F;hosts
node1的IP  node1
node2的IP  node2
node3的IP  node3</code></pre><p>如果用的是服务器，有一行是私有IP跟主机名，需要注释掉</p></li><li><p>确保各个节点的 cookie 文件使用的是同一个值</p><pre class="language-sh" data-language="sh"><code class="language-sh"># 在 node1 上执行远程操作命令
scp &#x2F;var&#x2F;lib&#x2F;rabbitmq&#x2F;.erlang.cookie root@node2:&#x2F;var&#x2F;lib&#x2F;rabbitmq&#x2F;.erlang.cookie
scp &#x2F;var&#x2F;lib&#x2F;rabbitmq&#x2F;.erlang.cookie root@node3:&#x2F;var&#x2F;lib&#x2F;rabbitmq&#x2F;.erlang.cookie</code></pre></li><li><p>启动 RabbitMQ 服务,顺带启动 Erlang 虚拟机和 RbbitMQ 应用服务(在三台节点上分别执行以下命令)</p><pre class="language-sh" data-language="sh"><code class="language-sh">rabbitmq-server -detached</code></pre></li><li><p>将节点2加入集群</p><pre class="language-sh" data-language="sh"><code class="language-sh"># 在 node2 上操作
rabbitmqctl stop_app
rabbitmqctl reset
rabbitmqctl join_cluster rabbit@node1
rabbitmqctl start_app</code></pre></li><li><p>将节点3加入集群</p><pre class="language-sh" data-language="sh"><code class="language-sh"># 在 node3 上操作
rabbitmqctl stop_app
rabbitmqctl reset
rabbitmqctl join_cluster rabbit@node1 # 这里node2也是可以的，因为node1跟node2已经是一个集群了
rabbitmqctl start_app</code></pre></li><li><p>集群状态</p><pre class="language-none"><code class="language-none">rabbitmqctl cluster_status</code></pre></li></ol><h3 id="8-1-2-移除节点"><a href="#8-1-2-移除节点" class="headerlink" title="8.1.2 移除节点"></a>8.1.2 移除节点</h3><ol><li><p>将要移除的节点停机</p><pre class="language-sh" data-language="sh"><code class="language-sh">&#x2F;sbin&#x2F;service rabbitmq-server stop</code></pre></li><li><p>主机上查看要移除的节点是否停机</p><pre class="language-sh" data-language="sh"><code class="language-sh">rabbitmqctl cluster_status</code></pre></li><li><p>在主机上移除要移除的节点</p><pre class="language-sh" data-language="sh"><code class="language-sh">rabbitmqctl forget_cluster_node rabbit@node3 </code></pre></li><li><p><code>--offline</code> 选项,用于删除最后一个节点</p></li></ol><h2 id="8-2-镜像队列"><a href="#8-2-镜像队列" class="headerlink" title="8.2 镜像队列"></a>8.2 镜像队列</h2><h3 id="8-2-1-说明"><a href="#8-2-1-说明" class="headerlink" title="8.2.1 说明"></a>8.2.1 说明</h3><ol><li>如果 RabbitMQ 集群中只有一个 Broker 节点，那么该节点的失效将导致整体服务的临时性不可用，并且也可能会导致消息的丢失</li><li>即使设置消息、队列持久化也无法避免由于缓存导致的问题：因为消息在发送之后和被写入磁盘并执行刷盘动作之间存在一个短暂却会产生问题的时间窗</li><li>通过 publisherconfirm 机制能够确保客户端知道哪些消息己经存入磁盘，尽管如此， 一般不希望遇到因单点故障导致的服务不可用。</li><li>引入镜像队列(Mirror Queue)的机制，可以将队列镜像到集群中的其他 Broker 节点之上，如果集群中的一个节点失效了，队列能自动地切换到镜像中的另一个节点上以保证服务的可用性</li></ol><h3 id="8-2-2-搭建"><a href="#8-2-2-搭建" class="headerlink" title="8.2.2 搭建"></a>8.2.2 搭建</h3><ol><li><p>步骤</p><p><img src="https://raw.githubusercontent.com/JabinHao/mihs/master/blog/RabbitMQ/8-1.png" srcset="/img/loading.gif"></p></li><li><p>说明</p><ul><li>Name：策略名，可以随意起</li><li>Pattern：正则表达式，这里表示为 mirrior开头的队列创建镜像队列</li><li>ha-mode：镜像队列模式，<ul><li>all：在集群所有节点上进行镜像</li><li>exactly：在指定个数的节点上镜像，节点个数由 ha-params 指定</li><li>nodes：在指定节点上进行镜像，节点名称通过ha-params 指定</li></ul></li><li>ha-params：exactly 模式下为数字表述镜像节点数，nodes 模式下为节点列表表示需要镜像的节点</li><li>ha-sync-mode：镜像队列中消息的同步方式，其值可为”automatic”或”manually”.</li></ul></li></ol><h2 id="8-3-Haproxy-Keepalive-实现高可用负载均衡"><a href="#8-3-Haproxy-Keepalive-实现高可用负载均衡" class="headerlink" title="8.3 Haproxy+Keepalive 实现高可用负载均衡"></a>8.3 Haproxy+Keepalive 实现高可用负载均衡</h2><h3 id="8-3-1-说明"><a href="#8-3-1-说明" class="headerlink" title="8.3.1 说明"></a>8.3.1 说明</h3><ol><li><p>架构</p><p><img src="https://raw.githubusercontent.com/JabinHao/mihs/master/blog/RabbitMQ/8-2.png" srcset="/img/loading.gif"></p></li><li><p>Haproxy 实现负载均衡</p><ul><li>HAProxy 提供高可用性、负载均衡及基于 TCP HTTP 应用的代理，支持虚拟主机</li><li>HAProxy 实现了一种事件驱动、单一进程模型，此模型支持非常大的井发连接数</li><li>同类软件：nginx, lvs</li></ul></li></ol><h3 id="8-3-2-Haproxy-负载均衡"><a href="#8-3-2-Haproxy-负载均衡" class="headerlink" title="8.3.2 Haproxy 负载均衡"></a>8.3.2 Haproxy 负载均衡</h3><ol><li><p>安装（node1 和 node2）</p><pre class="language-sh" data-language="sh"><code class="language-sh">yum -y install haproxy</code></pre></li><li><p>配置</p><pre class="language-none"><code class="language-none"># 修改配置文件（node1 和 node2 相同）
vim &#x2F;etc&#x2F;haproxy&#x2F;haproxy.cfg</code></pre><p>修改为以下内容：</p><pre class="language-cfg" data-language="cfg"><code class="language-cfg"># 前面的不动
defaults
    mode                    http
    log                     global
    option                  httplog
    option                  dontlognull
    option http-server-close
    option forwardfor       except 127.0.0.0&#x2F;8
    option                  redispatch
    retries                 3
    timeout http-request    10s
    timeout queue           1m
    timeout connect         10s
    timeout client          1m
    timeout server          1m
    timeout http-keep-alive 10s
    timeout check           10s
    maxconn                 3000

#---------------------------------------------------------------------
### haproxy 监控页面地址是：http:&#x2F;&#x2F;IP:9188&#x2F;hastatus
listen admin_stats
    bind *:9188   #监听的地址和端口，默认端口1080
    mode http      #模式
    option tcplog
    stats refresh 5s    #页面自动刷新间隔,每隔5s刷新
    stats uri &#x2F;hastatus  #访问路径，在域名后面添加&#x2F;stats可以查看haproxy监控状态,默认为&#x2F;haproxy?stats
    stats realm welcome login\ Haproxy  #提示信息，空格之前加\
    stats auth admin:hjp356908  #登陆用户名和密码
    stats hide-version   #隐藏软件版本号
    stats admin if TRUE   #当通过认证才可管理
#-------------------------------------------------
frontend rabbitmq
    mode tcp
    bind *:5679
    timeout client 168h
    default_backend rabbitmq_nodes
    log global
    option tcplog
    option logasap
backend rabbitmq_nodes
    mode tcp
    balance roundrobin
    server node1 139.224.113.9:5672   check inter 5000 rise 2 fall 3 weight 1
    server node2 139.224.221.186:5672 check inter 5000 rise 2 fall 3 weight 1
    server node3 47.103.72.213:5672   check inter 5000 rise 2 fall 3 weight 1

#rabbitmq 集群配置
listen rabbitmq_admin
    bind  0.0.0.0:15679
    mode http
    balance roundrobin
    server node1 139.224.113.9:5672   check inter 5000 rise 2 fall 3 weight 1
    server node2 139.224.221.186:5672 check inter 5000 rise 2 fall 3 weight 1
    server node3 47.103.72.213:5672   check inter 5000 rise 2 fall 3 weight 1</code></pre></li><li><p>启动</p><pre class="language-sh" data-language="sh"><code class="language-sh">haproxy -f &#x2F;etc&#x2F;haproxy&#x2F;haproxy.cfg
ps -ef | grep haproxy</code></pre></li><li><p>查看</p><p><a target="_blank" rel="noopener" href="http://ip:9188/hastatus">http://IP:9188/hastatus</a></p></li></ol><h2 id="8-4-Federation-Exchange-与-Federation-Queue"><a href="#8-4-Federation-Exchange-与-Federation-Queue" class="headerlink" title="8.4 Federation Exchange 与 Federation Queue"></a>8.4 Federation Exchange 与 Federation Queue</h2><h3 id="8-4-1-说明"><a href="#8-4-1-说明" class="headerlink" title="8.4.1 说明"></a>8.4.1 说明</h3><ol><li>联邦机制的实现，依赖于RabbitMQ的Federation插件，该插件的主要目标是为了RabbitMQ可以在多个 Broker节点或者集群中进行消息的无缝传递</li><li>Federation插件可以让多个交换器和多个队列进行联邦。一个联邦交换器或者一个联邦队列接受上游(位于其他Broker上的交换器和队列)消息。<ul><li>联邦交换器能够将原本发送给上游交换器(upstream exchange)的消息路由到本地的某个队列中</li><li>联邦队列则允许一个本地消费者接收到来自上游队列(upstream queue)的消息</li></ul></li></ol><h3 id="8-4-2-联邦交换机搭建"><a href="#8-4-2-联邦交换机搭建" class="headerlink" title="8.4.2 联邦交换机搭建"></a>8.4.2 联邦交换机搭建</h3><ol><li><p>原理</p><p><img src="https://raw.githubusercontent.com/JabinHao/mihs/master/blog/RabbitMQ/8-4.png" srcset="/img/loading.gif"></p><ul><li>有两个集群node1（上图的broker1）和node2（broker3），距离较远</li><li>node1附近的Client要向node2上传消息，会有很高的延迟</li><li>联邦后，broker1 的交换机直接接收消息，返回确认，消息再经Federation link转发给 broker3</li></ul></li><li><p>在每台机器上开启 federation 相关插件</p><pre class="language-sh" data-language="sh"><code class="language-sh">rabbitmq-plugins enable rabbitmq_federation
rabbitmq-plugins enable rabbitmq_federation_management</code></pre></li><li><p>首先要运行 consumer 在 node2 创建 fed_exchange（即上图的exchangeA）</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"node2的IP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">final</span> <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token class-name">Channel</span> channel1 <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span>FED_EXCHANGE<span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span>DIRECT<span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">"node2.queue"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span><span class="token string">"node2.queue"</span><span class="token punctuation">,</span> FED_EXCHANGE<span class="token punctuation">,</span> <span class="token string">"routing.key"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> message<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
channel1<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token string">"node2.queue"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        deliverCallback<span class="token punctuation">,</span>
        consumerTag <span class="token operator">-></span> <span class="token punctuation">&#123;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"消费消息被中断"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>在 downstream(node2)配置 upstream(node1)</p><p><img src="https://raw.githubusercontent.com/JabinHao/mihs/master/blog/RabbitMQ/8-5.png" srcset="/img/loading.gif"></p><ul><li>Name：随意起，等会会用到</li><li>URI：amqp://用户名:密码@node1</li></ul></li><li><p>定义policy（node2）</p><p><img src="https://raw.githubusercontent.com/JabinHao/mihs/master/blog/RabbitMQ/8-6.png" srcset="/img/loading.gif"></p><ul><li>Name：随意</li><li>Pattern：正则表达式，^fed.*</li><li>Apply to：Exchanges</li><li>Definition：federation-upstream = upstream名</li></ul></li></ol><h3 id="8-4-3-Federation-Queue-搭建"><a href="#8-4-3-Federation-Queue-搭建" class="headerlink" title="8.4.3 Federation Queue 搭建"></a>8.4.3 Federation Queue 搭建</h3><ol><li><p>原理</p><p><img src="https://raw.githubusercontent.com/JabinHao/mihs/master/blog/RabbitMQ/8-7.png" srcset="/img/loading.gif"></p><ul><li>以 node1 为上游队列，node2 被联邦到 node1</li><li>node2 可以接收到来自 node1 的消息</li><li>也可以互为联邦队列，一条消息可以在联邦队列间转发无限次</li><li>federation queue只能使用Basic.Consume进行消费，并且不具备传递性</li></ul></li><li><p>添加 upstream （同上）</p></li><li><p>添加Ploicy</p><ul><li>将 Apply to改为 Queues</li><li>其它同上</li></ul></li></ol><h2 id="8-6-Shovel"><a href="#8-6-Shovel" class="headerlink" title="8.6 Shovel"></a>8.6 Shovel</h2><h3 id="8-6-1-说明"><a href="#8-6-1-说明" class="headerlink" title="8.6.1 说明"></a>8.6.1 说明</h3><ol><li><p>与 Federation 具备的数据转发功能类似， Shovel 能够可靠、持续地从一个 Broker 中的队列拉取数据并转发至另一个 Broker 中的交换器</p></li><li><p>作为源端的队列和作为目的端的交换器可以同时位于同一个 Broker ，也可以位于不同的 Broker 上</p></li><li><p>原理</p><p><img src="https://raw.githubusercontent.com/JabinHao/mihs/master/blog/RabbitMQ/8-8.png" srcset="/img/loading.gif"></p><ul><li>在队列 queue1 和交换器 exchange2 之间配置一个 Shovel link，当一条内容为 shovel test payload 的消息从客户端发送至交换器 exchange1 的时候，这条消息会经过上图中的数据流转最后存储在队列 queue2 中</li><li>通常情况下，使用 Shovel 时配置队列作为源端，交换器作为目的端，但同样可以将队列配置为目的端：（通过broker2的默认交换器转发）</li></ul></li></ol><h3 id="8-6-2-搭建"><a href="#8-6-2-搭建" class="headerlink" title="8.6.2 搭建"></a>8.6.2 搭建</h3><ol><li><p>启动插件</p><pre class="language-sh" data-language="sh"><code class="language-sh">rabbitmq-plugins enable rabbitmq_shovel
rabbitmq-plugins enable rabbitmq_shovel_management</code></pre></li><li><p>添加 shovel 源和目的地</p><p><img src="https://raw.githubusercontent.com/JabinHao/mihs/master/blog/RabbitMQ/8-9.png" srcset="/img/loading.gif"></p></li></ol></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/RabbitMQ/">RabbitMQ</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/RabbitMQ/">RabbitMQ</a></div></div><div class="post-prevnext row"><article class="post-prev col-6"><a href="/posts/933c65ac/"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Java对象大小</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/posts/9aefa79f/"><span class="hidden-mobile">Chapter7 其它知识点</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments"><div class="disqus" style="width:100%"><div id="disqus_thread"></div><script>function loadDisqus(){addCssLink("https://cdn.jsdelivr.net/npm/disqusjs@1.0/dist/disqusjs.css"),addScript("https://cdn.jsdelivr.net/npm/disqusjs@1.0/dist/disqus.js",(function(){new DisqusJS({shortname:"Jacob",apikey:""})}))}waitElementVisible("disqus_thread",loadDisqus)</script><noscript>Please enable JavaScript to view the <a target="_blank" href="https://disqus.com/?ref_noscript" rel="nofollow noopener noopener">comments powered by Disqus.</a></noscript></div></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div id="tocbot"></div></div></div></div></div></main><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><footer class="mt-5"><div class="text-center py-3"><div><a href="https://github.com/" target="_blank" rel="nofollow noopener"><span>Github</span></a> <i class="iconfont icon-love"></i> <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a></div><div><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">总访问量 <span id="busuanzi_value_site_pv"></span> 次 </span><span id="busuanzi_container_site_uv" style="display:none">总访客数 <span id="busuanzi_value_site_uv"></span> 人</span></div></div><div><span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span><script>var now=new Date;function createtime(){var n=new Date("10/06/2020 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="本站安全运行&nbsp"+dnum+"&nbsp天",document.getElementById("times").innerHTML=hnum+"&nbsp小时&nbsp"+mnum+"&nbsp分&nbsp"+snum+"&nbsp秒"}setInterval("createtime()",250)</script></div></div></footer><script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script><script src="/js/debouncer.js"></script><script src="/js/main.js"></script><script src="/js/lazyload.js"></script><script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script src="/js/clipboard-use.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js"></script><script>$(document).ready((function(){var t=$("#board-ctn").offset().top;tocbot.init({tocSelector:"#tocbot",contentSelector:"#post-body",headingSelector:"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:3,scrollSmooth:!0,headingsOffset:-t}),$(".toc-list-item").length>0&&$("#toc").css("visibility","visible")}))</script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>var typed=new Typed("#subtitle",{strings:["  ","Chapter8 RabbitMQ 集群&nbsp;"],cursorChar:"|",typeSpeed:90,loop:!0});typed.stop(),$(document).ready((function(){$(".typed-cursor").addClass("h2"),typed.start()}))</script><script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script><script>anchors.options={placement:"right",visible:"hover"};var el="h1,h2,h3,h4,h5,h6".split(","),res=[];for(item of el)res.push(".markdown-body > "+item);anchors.add(res.join(", "))</script><script src="/js/local-search.js"></script><script>var path="/local-search.xml",inputArea=document.querySelector("#local-search-input");inputArea.onclick=function(){searchFunc(path,"local-search-input","local-search-result"),this.onclick=null}</script><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><script>$("#post img:not(.no-zoom img, img[no-zoom]), img[zoom]").each((function(){var t=document.createElement("a");$(t).attr("data-fancybox","images"),$(t).attr("href",$(this).attr("src")),$(this).wrap(t)}))</script></body></html>