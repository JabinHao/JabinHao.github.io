<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png"><link rel="icon" type="image/png" href="/img/site.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content="Jipeng Hao 的个人博客"><meta name="author" content="Martentite"><meta name="keywords" content="java, python, blog"><title>Chapter6后台管理 — 分配 - 山那边的小木屋</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/prism/1.21.0/themes/prism-okaidia.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_pf9vaxs7x7b.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="山那边的小木屋" type="application/atom+xml">
</head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>Jacob</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner intro-2" id="background" parallax="true" style="background:url(/img/post/banner/mandao.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="container page-header text-center fade-in-up"><span class="h2" id="subtitle"></span><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> Martentite </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2021-01-09 01:21" pubdate>2021年1月9日 凌晨</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 3.6k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 60 分钟</span></div></div></div></div></div></header><main><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="container nopadding-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto" id="post"><h1 style="display:none">Chapter6后台管理 — 分配</h1><div class="markdown-body" id="post-body"><h2 id="6-1-说明"><a href="#6-1-说明" class="headerlink" title="6.1 说明"></a>6.1 说明</h2><h3 id="6-1-1-权限分配思路"><a href="#6-1-1-权限分配思路" class="headerlink" title="6.1.1 权限分配思路"></a>6.1.1 权限分配思路</h3><ol><li>思路<br><img src="https://raw.githubusercontent.com/JabinHao/mihs/master/blog/crowd_funding/5-4-1.png" srcset="/img/loading.gif"></li></ol><h3 id="6-2-1-实现"><a href="#6-2-1-实现" class="headerlink" title="6.2.1 实现"></a>6.2.1 实现</h3><ol><li>权限分配通过 SpringSecurity 框架来实现</li><li>我们需要给Admin分配好相应的Role</li></ol><h2 id="6-2-给Admin分配Role"><a href="#6-2-给Admin分配Role" class="headerlink" title="6.2 给Admin分配Role"></a>6.2 给Admin分配Role</h2><h3 id="6-2-1-目标思路"><a href="#6-2-1-目标思路" class="headerlink" title="6.2.1 目标思路"></a>6.2.1 目标思路</h3><ol><li>目标：通过页面操作把 Admin 和 Role 之间的关联关系保存到数据库</li><li>思路<br><img src="https://raw.githubusercontent.com/JabinHao/mihs/master/blog/crowd_funding/6-2-1.png" srcset="/img/loading.gif"></li></ol><h3 id="6-2-2-后端代码"><a href="#6-2-2-后端代码" class="headerlink" title="6.2.2 后端代码"></a>6.2.2 后端代码</h3><ol><li>数据库表<pre class="language-mysql" data-language="mysql"><code class="language-mysql"># 权限分配
DROP TABLE IF EXISTS inner_admin_role;
CREATE TABLE &#96;inner_admin_role&#96; (
    id          INT NOT NULL AUTO_INCREMENT,
    admin_id    INT,
    role_id     INT,
    PRIMARY KEY (id)
);</code></pre></li><li>修改分配按钮的超链接 admin-page.jsp<pre class="language-JSP" data-language="JSP"><code class="language-JSP">&lt;a href&#x3D;&quot;assign&#x2F;to&#x2F;assign&#x2F;role&#x2F;page.do?adminId&#x3D;$&#123;admin.id &#125;&amp;pageNum&#x3D;$&#123;requestScope.pageInfo.pageNum&#125;&amp;keyword&#x3D;$&#123;param.keyword&#125;&quot; class&#x3D;&quot;btn btn-success btn-xs&quot;&gt;&lt;i class&#x3D;&quot; glyphicon glyphicon-check&quot;&gt;&lt;&#x2F;i&gt;&lt;&#x2F;a&gt;</code></pre></li><li>AssignHandler<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AssignHandler</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AdminService</span> adminService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RoleService</span> roleService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/assign/to/assign/role/page.do"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toAssignRolePage</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"adminId"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> adminId<span class="token punctuation">,</span>
                                <span class="token class-name">ModelMap</span> modelMap<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token comment">// 1.查询已分配的角色</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">></span></span> assignedRoleList <span class="token operator">=</span> roleService<span class="token punctuation">.</span><span class="token function">getAssignedRole</span><span class="token punctuation">(</span>adminId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2. 查询未分配的角色</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">></span></span> unAssignedRoleList <span class="token operator">=</span> roleService<span class="token punctuation">.</span><span class="token function">getUnAssignedRole</span><span class="token punctuation">(</span>adminId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3.存入模型</span>
        modelMap<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"assignedRoleList"</span><span class="token punctuation">,</span> assignedRoleList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelMap<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"unAssignedRoleList"</span><span class="token punctuation">,</span> unAssignedRoleList<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token string">"assign-role"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li><li>RoleService<pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">></span></span> <span class="token function">getAssignedRole</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> adminId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">></span></span> <span class="token function">getUnAssignedRole</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> adminId<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">></span></span> <span class="token function">getAssignedRole</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> adminId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">return</span> roleMapper<span class="token punctuation">.</span><span class="token function">selectAssignedRole</span><span class="token punctuation">(</span>adminId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">></span></span> <span class="token function">getUnAssignedRole</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> adminId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> roleMapper<span class="token punctuation">.</span><span class="token function">selectUnAssignedRole</span><span class="token punctuation">(</span>adminId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li><li>RoleMapper<pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">></span></span> <span class="token function">selectAssignedRole</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> adminId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">></span></span> <span class="token function">selectUnAssignedRole</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> adminId<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectAssignedRole<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BaseResultMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    select id, name from t_role where id in (select role_id from inner_admin_role where admin_id = #&#123;adminId&#125;)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectUnAssignedRole<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BaseResultMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    select id, name from t_role where id not in (select role_id from inner_admin_role where admin_id = #&#123;adminId&#125;)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre></li></ol><h3 id="6-2-3-前端代码"><a href="#6-2-3-前端代码" class="headerlink" title="6.2.3 前端代码"></a>6.2.3 前端代码</h3><ol><li><p>修改agmin-page.jap</p><pre class="language-html" data-language="html"><code class="language-html">&lt;%-- <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-success btn-xs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> glyphicon glyphicon-check<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span> --%>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>assign/to/assign/role/page.do?adminId=$&#123;admin.id &#125;&amp;pageNum=$&#123;requestScope.pageInfo.pageNum&#125;&amp;keyword=$&#123;param.keyword&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-success btn-xs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> glyphicon glyphicon-check<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></code></pre></li><li><p>新建 assign-role.jsp</p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;%@ page contentType&#x3D;&quot;text&#x2F;html;charset&#x3D;UTF-8&quot; language&#x3D;&quot;java&quot; %&gt;
&lt;%@taglib prefix&#x3D;&quot;c&quot; uri&#x3D;&quot;http:&#x2F;&#x2F;java.sun.com&#x2F;jsp&#x2F;jstl&#x2F;core&quot; %&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang&#x3D;&quot;zh-CN&quot;&gt;
&lt;%@include file&#x3D;&quot;include-head.jsp&quot; %&gt;

&lt;body&gt;
&lt;%@include file&#x3D;&quot;include-nav.jsp&quot; %&gt;
&lt;div class&#x3D;&quot;container-fluid&quot;&gt;
    &lt;div class&#x3D;&quot;row&quot;&gt;
        &lt;%@include file&#x3D;&quot;include-sidebar.jsp&quot; %&gt;
        &lt;div class&#x3D;&quot;col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main&quot;&gt;
            &lt;ol class&#x3D;&quot;breadcrumb&quot;&gt;
                &lt;li&gt;&lt;a href&#x3D;&quot;#&quot;&gt;首页&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
                &lt;li&gt;&lt;a href&#x3D;&quot;#&quot;&gt;数据列表&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
                &lt;li class&#x3D;&quot;active&quot;&gt;分配角色&lt;&#x2F;li&gt;
            &lt;&#x2F;ol&gt;
            &lt;div class&#x3D;&quot;panel panel-default&quot;&gt;
                &lt;div class&#x3D;&quot;panel-body&quot;&gt;
                    &lt;form action&#x3D;&quot;assign&#x2F;do&#x2F;role&#x2F;assign.do&quot; method&#x3D;&quot;post&quot; role&#x3D;&quot;form&quot; class&#x3D;&quot;form-inline&quot;&gt;
                        &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;adminId&quot; value&#x3D;&quot;$&#123;param.adminId&#125;&quot;&gt;
                        &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;pageNum&quot; value&#x3D;&quot;$&#123;param.pageNum&#125;&quot;&gt;
                        &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;keyword&quot; value&#x3D;&quot;$&#123;param.keyword&#125;&quot;&gt;
                        &lt;div class&#x3D;&quot;form-group&quot;&gt;
                            &lt;label&gt;未分配角色列表&lt;&#x2F;label&gt;&lt;br&gt;
                            &lt;select class&#x3D;&quot;form-control&quot; multiple&#x3D;&quot;&quot; size&#x3D;&quot;10&quot; style&#x3D;&quot;width:100px;overflow-y:auto;&quot;&gt;
                                &lt;c:forEach items&#x3D;&quot;$&#123;requestScope.unAssignedRoleList&#125;&quot; var&#x3D;&quot;role&quot;&gt;
                                    &lt;option value&#x3D;&quot;$&#123;role.id&#125;&quot;&gt;$&#123;role.name &#125;&lt;&#x2F;option&gt;
                                &lt;&#x2F;c:forEach&gt;
                            &lt;&#x2F;select&gt;
                        &lt;&#x2F;div&gt;
                        &lt;div class&#x3D;&quot;form-group&quot;&gt;
                            &lt;ul&gt;
                                &lt;li class&#x3D;&quot;btn btn-default glyphicon glyphicon-chevron-right&quot;&gt;&lt;&#x2F;li&gt;
                                &lt;br&gt;
                                &lt;li class&#x3D;&quot;btn btn-default glyphicon glyphicon-chevron-left&quot; style&#x3D;&quot;margin-top:20px;&quot;&gt;&lt;&#x2F;li&gt;
                            &lt;&#x2F;ul&gt;
                        &lt;&#x2F;div&gt;
                        &lt;div class&#x3D;&quot;form-group&quot; style&#x3D;&quot;margin-left:40px;&quot;&gt;
                            &lt;label&gt;已分配角色列表&lt;&#x2F;label&gt;&lt;br&gt;
                            &lt;select name&#x3D;&quot;roleList&quot; class&#x3D;&quot;form-control&quot; multiple&#x3D;&quot;multiple&quot; size&#x3D;&quot;10&quot; style&#x3D;&quot;width:100px;overflow-y:auto;&quot;&gt;
                                &lt;c:forEach items&#x3D;&quot;$&#123;requestScope.assignedRoleList&#125;&quot; var&#x3D;&quot;role&quot;&gt;
                                    &lt;option value&#x3D;&quot;$&#123;role.id&#125;&quot;&gt;$&#123;role.name &#125;&lt;&#x2F;option&gt;
                                &lt;&#x2F;c:forEach&gt;
                            &lt;&#x2F;select&gt;
                        &lt;&#x2F;div&gt;
                        &lt;br&#x2F;&gt;&lt;br&gt;&lt;br&gt;
                        &lt;button type&#x3D;&quot;submit&quot; style&#x3D;&quot;width: 150px;&quot; class&#x3D;&quot;btn btn-lg btn-success btn-block&quot;&gt;提交&lt;&#x2F;button&gt;
                    &lt;&#x2F;form&gt;
                &lt;&#x2F;div&gt;
            &lt;&#x2F;div&gt;
        &lt;&#x2F;div&gt;
    &lt;&#x2F;div&gt;
&lt;&#x2F;div&gt;
&lt;&#x2F;body&gt;
&lt;&#x2F;html&gt;</code></pre></li><li><p>assign-role.jsp：实现角色左右移动</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 1.左侧选择移到右侧列表</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#toRightBtn"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">/*
        select 是标签选择器
        :eq(0)表示选择页面上的第一个
        :eq(1)表示选择页面上的第二个
        “>” 表示选择子元素
        :selected 表示选择“被选中的” option
        appendTo()能够将 jQuery 对象追加到指定的位置
        */</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"select:eq(0)>option:selected"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendTo</span><span class="token punctuation">(</span><span class="token string">"select:eq(1)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2.右侧选择移到左侧列表</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#toLeftBtn"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"select:eq(1)>option:selected"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendTo</span><span class="token punctuation">(</span><span class="token string">"select:eq(0)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre><p>给两个箭头添加id</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>toRightBtn<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-default glyphicon glyphicon-chevron-right<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>toLeftBtn<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-default glyphicon glyphicon-chevron-left<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">margin-top</span><span class="token punctuation">:</span>20px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></code></pre></li></ol><h3 id="6-2-4-后端代码：实现分配"><a href="#6-2-4-后端代码：实现分配" class="headerlink" title="6.2.4 后端代码：实现分配"></a>6.2.4 后端代码：实现分配</h3><ol><li><p>handler</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/assign/do/role/assign.do"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">saveAdminRoleRelationship</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"adminId"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> adminId<span class="token punctuation">,</span>
                                        <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"pageNum"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> pageNum<span class="token punctuation">,</span>
                                        <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"keyword"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> keyword<span class="token punctuation">,</span>
                                        <span class="token comment">//允许用户在页面上取消所有角色，故该参数可以不提交</span>
                                        <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"roleIdList"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> roleIdList<span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>

    adminService<span class="token punctuation">.</span><span class="token function">saveAdminRoleRelationship</span><span class="token punctuation">(</span>adminId<span class="token punctuation">,</span> roleIdList<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token string">"redirect:/admin/get/page.do?pageNum="</span><span class="token operator">+</span>pageNum<span class="token operator">+</span><span class="token string">"&amp;keyword="</span><span class="token operator">+</span>keyword<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li><li><p>AdminService</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">void</span> <span class="token function">saveAdminRoleRelationship</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> adminId<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> roleIdList<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveAdminRoleRelationship</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> adminId<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> roleIdList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">// 1. 根据adminId删除旧的关联关系数据</span>
    adminMapper<span class="token punctuation">.</span><span class="token function">deleteOldRelationship</span><span class="token punctuation">(</span>adminId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2.根据roleIdList和adminId保存新的关联关系</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>roleIdList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> roleIdList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        adminMapper<span class="token punctuation">.</span><span class="token function">insertNewRelationship</span><span class="token punctuation">(</span>adminId<span class="token punctuation">,</span> roleIdList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li><li><p>AdminMapper</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">void</span> <span class="token function">deleteOldRelationship</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> adminId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">insertNewRelationship</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"adminId"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> adminId<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"roleIdList"</span><span class="token punctuation">)</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> roleIdList<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>delete</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>deleteOldRelationship<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    delete from inner_admin_role where admin_id=#&#123;adminId&#125;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>delete</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>insertNewRelationship<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    insert into inner_admin_role(admin_id, role_id) VALUES
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>roleIdList<span class="token punctuation">"</span></span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>roleId<span class="token punctuation">"</span></span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>,<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>(#&#123;adminId&#125;,#&#123;roleId&#125;)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span></code></pre></li><li><p>bug修正: assign-role.jsp</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#submitBtn"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"select:eq(1)>option"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">"selected"</span><span class="token punctuation">,</span><span class="token string">"selected"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 为了看到上面代码的效果， 暂时不让表单提交</span>
    <span class="token comment">// return false;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submitBtn<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-lg btn-success btn-block<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span></code></pre></li></ol><h2 id="6-3-给-Role-分配-Auth"><a href="#6-3-给-Role-分配-Auth" class="headerlink" title="6.3 给 Role 分配 Auth"></a>6.3 给 Role 分配 Auth</h2><h3 id="6-3-1-目标思路"><a href="#6-3-1-目标思路" class="headerlink" title="6.3.1 目标思路"></a>6.3.1 目标思路</h3><ol><li>目标：把角色和权限的关联关系保存到数据库</li><li>思路<br><img src="https://raw.githubusercontent.com/JabinHao/mihs/master/blog/crowd_funding/6-3-1.png" srcset="/img/loading.gif"></li><li>说明：<ul><li>权限管理菜单下应还有一个权限维护</li><li>权限维护与菜单维护类似，树形结构显示，增删改查功能，为节省时间，本项目中省略</li></ul></li></ol><h3 id="6-3-2-准备工作"><a href="#6-3-2-准备工作" class="headerlink" title="6.3.2 准备工作"></a>6.3.2 准备工作</h3><ol><li>新建数据库表<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># t_auth</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t_auth<span class="token punctuation">`</span> <span class="token punctuation">(</span>
                        <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
                        <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
                        <span class="token punctuation">`</span>title<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
                        <span class="token punctuation">`</span>category_id<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
                        <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_auth<span class="token punctuation">(</span>id<span class="token punctuation">,</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span>title<span class="token punctuation">,</span>category_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token string">'用户模块'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_auth<span class="token punctuation">(</span>id<span class="token punctuation">,</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span>title<span class="token punctuation">,</span>category_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'user:delete'</span><span class="token punctuation">,</span><span class="token string">'删除'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_auth<span class="token punctuation">(</span>id<span class="token punctuation">,</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span>title<span class="token punctuation">,</span>category_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'user:get'</span><span class="token punctuation">,</span><span class="token string">'查询'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_auth<span class="token punctuation">(</span>id<span class="token punctuation">,</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span>title<span class="token punctuation">,</span>category_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token string">'角色模块'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_auth<span class="token punctuation">(</span>id<span class="token punctuation">,</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span>title<span class="token punctuation">,</span>category_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'role:delete'</span><span class="token punctuation">,</span><span class="token string">'删除'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_auth<span class="token punctuation">(</span>id<span class="token punctuation">,</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span>title<span class="token punctuation">,</span>category_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">'role:get'</span><span class="token punctuation">,</span><span class="token string">'查询'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_auth<span class="token punctuation">(</span>id<span class="token punctuation">,</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span>title<span class="token punctuation">,</span>category_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token string">'role:add'</span><span class="token punctuation">,</span><span class="token string">'新增'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li>name 字段： 给资源分配权限或给角色分配权限时使用的具体值， 将来做权限验证也是使用 name 字段的值来进行比对。 建议使用英文。</li><li>title 字段： 在页面上显示， 让用户便于查看的值。 建议使用中文。</li><li>category_id 字段： 关联到当前权限所属的分类。 这个关联不是到其他表关联， 而是就在当前表内部进行关联， 关联其他记录。 所以说t_auth 表中是依靠 category_id 字段建立了“节点” 之间的父子关系。</li></ul></li><li>逆向工程：<ul><li>generatorConfig.xml<pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!--  数据库表名字和我们的 entity 类对应的映射指定 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">tableName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>t_auth<span class="token punctuation">"</span></span> <span class="token attr-name">domainObjectName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Auth<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre></li><li>mybatis-generator:generate</li></ul></li><li>给Auth类添加无参构造器和有参构造器</li><li>资源归位</li><li>新建AuthService接口及其实现类<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AuthService</span> <span class="token punctuation">&#123;</span>
<span class="token punctuation">&#125;</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AuthService</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AuthMapper</span> authMapper<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li><li>在 AssignHandler中装配<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">AuthService</span> authService<span class="token punctuation">;</span></code></pre></li></ol><h3 id="6-3-3-过渡工作一-—-获取全部权限生成树形结构"><a href="#6-3-3-过渡工作一-—-获取全部权限生成树形结构" class="headerlink" title="6.3.3 过渡工作一 — 获取全部权限生成树形结构"></a>6.3.3 过渡工作一 — 获取全部权限生成树形结构</h3><ol><li><p>修改 my-role.js</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> checkBtn <span class="token operator">=</span> <span class="token string">"&lt;button id='"</span> <span class="token operator">+</span> roleId <span class="token operator">+</span> <span class="token string">"' type=\"button\" class=\"btn btn-success btn-xs checkBtn\">&lt;i class=\" glyphicon glyphicon-check\">&lt;/i>&lt;/button>"</span><span class="token punctuation">;</span></code></pre></li><li><p>准备模态框：新建 modal-role-assign-auth.jsp</p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;%@ page contentType&#x3D;&quot;text&#x2F;html;charset&#x3D;UTF-8&quot; language&#x3D;&quot;java&quot; %&gt;
&lt;div id&#x3D;&quot;assignModal&quot; class&#x3D;&quot;modal fade&quot; tabindex&#x3D;&quot;-1&quot; role&#x3D;&quot;dialog&quot;&gt;
    &lt;div class&#x3D;&quot;modal-dialog&quot; role&#x3D;&quot;document&quot;&gt;
        &lt;div class&#x3D;&quot;modal-content&quot;&gt;
            &lt;div class&#x3D;&quot;modal-header&quot;&gt;
                &lt;button type&#x3D;&quot;button&quot; class&#x3D;&quot;close&quot; data-dismiss&#x3D;&quot;modal&quot;
                        aria-label&#x3D;&quot;Close&quot;&gt;
                    &lt;span aria-hidden&#x3D;&quot;true&quot;&gt;&amp;times;&lt;&#x2F;span&gt;
                &lt;&#x2F;button&gt;
                &lt;h4 class&#x3D;&quot;modal-title&quot;&gt;尚筹网系统弹窗&lt;&#x2F;h4&gt;
            &lt;&#x2F;div&gt;
            &lt;div class&#x3D;&quot;modal-body&quot;&gt;
                &lt;ul id&#x3D;&quot;authTreeDemo&quot; class&#x3D;&quot;ztree&quot;&gt;&lt;&#x2F;ul&gt;
            &lt;&#x2F;div&gt;
            &lt;div class&#x3D;&quot;modal-footer&quot;&gt;
                &lt;button id&#x3D;&quot;assignBtn&quot; type&#x3D;&quot;button&quot; class&#x3D;&quot;btn btn-primary&quot;&gt;好的，我设置好了！执行分配！&lt;&#x2F;button&gt;
            &lt;&#x2F;div&gt;
        &lt;&#x2F;div&gt;
    &lt;&#x2F;div&gt;
&lt;&#x2F;div&gt;</code></pre></li><li><p>在 role-page.jsp中引入模态框并绑定单击响应函数</p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;ztree&#x2F;zTreeStyle.css&quot;&gt;
&lt;script type&#x3D;&quot;text&#x2F;javascript&quot; src&#x3D;&quot;ztree&#x2F;jquery.ztree.all-3.5.min.js&quot;&gt;&lt;&#x2F;script&gt;
&lt;script type&#x3D;&quot;text&#x2F;javascript&quot; src&#x3D;&quot;js&#x2F;my-role.js&quot;&gt;&lt;&#x2F;script&gt;</code></pre><pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">// 13.给分配权限按钮绑定单击响应函数</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#rolePageBody"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token string">".checkBtn"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">// 打开模态框</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#assignModal"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modal</span><span class="token punctuation">(</span><span class="token string">"show"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//  在模态框中装载Auth的树形结构数据</span>
    <span class="token function">fillAuthTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;%@include file&#x3D;&quot;modal-role-assign-auth.jsp&quot;%&gt;</code></pre></li><li><p>my-role.js中声明函数</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">// 声明专门的函数用来在分配Auth的模态框中显示Auth的树形结构数据</span>
<span class="token keyword">function</span> <span class="token function">fillAuthTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token comment">// a.发送ajax请求查询Auth数据</span>
    <span class="token keyword">var</span> ajaxReturn <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        url<span class="token operator">:</span> <span class="token string">"assign/get/all/auth.do"</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">"post"</span><span class="token punctuation">,</span>
        dataType<span class="token operator">:</span> <span class="token string">"json"</span><span class="token punctuation">,</span>
        async<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>ajaxReturn<span class="token punctuation">.</span>status <span class="token operator">!==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        layer<span class="token punctuation">.</span><span class="token function">msg</span><span class="token punctuation">(</span><span class="token string">"请求处理出错！响应状态码是："</span><span class="token operator">+</span>ajaxReturn<span class="token punctuation">.</span>status<span class="token operator">+</span><span class="token string">" 说明："</span><span class="token operator">+</span>ajaxReturn<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// b.从响应结果中获取Auth的JSON数据</span>
    <span class="token comment">// 从服务器端查询到的 list 不需要组装成树形结构， 这里我们交给 zTree 去组装</span>
    <span class="token keyword">var</span> authList <span class="token operator">=</span> ajaxReturn<span class="token punctuation">.</span>responseJSON<span class="token punctuation">.</span>data<span class="token punctuation">;</span>

    <span class="token comment">// c.准备对 zTree 进行设置的 JSON 对象</span>
    <span class="token keyword">var</span> setting <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        data<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            simpleData<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// 开启简单JSON功能</span>
                enable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

                <span class="token comment">// 使用 categoryId属性关联父节点，不用pid</span>
                pIdKey<span class="token operator">:</span> <span class="token string">"categoryId"</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            key<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// 使用 title 属性显示节点名称， 不用默认的 name 作为属性名</span>
                name<span class="token operator">:</span> <span class="token string">"title"</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        check<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            enable<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token comment">// d.生成树形结构</span>
    $<span class="token punctuation">.</span>fn<span class="token punctuation">.</span>zTree<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#authTreeDemo"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> setting<span class="token punctuation">,</span> authList<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 获取 zTreeObj 对象</span>
    <span class="token keyword">let</span> zTreeObj <span class="token operator">=</span> $<span class="token punctuation">.</span>fn<span class="token punctuation">.</span>zTree<span class="token punctuation">.</span><span class="token function">getZTreeObj</span><span class="token punctuation">(</span><span class="token string">"authTreeDemo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 调用 zTreeObj 对象的方法， 把节点展开</span>
    zTreeObj<span class="token punctuation">.</span><span class="token function">expandAll</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// e. 查询已分配的Auth的id组成的数组</span>

    <span class="token comment">// f. 根据 authIdArray 把树形结构中对应的节点勾选上</span>
<span class="token punctuation">&#125;</span></code></pre></li><li><p>AssignHandler</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ResponseBody</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/assign/get/all/auth.do"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Auth</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token function">getAllAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Auth</span><span class="token punctuation">></span></span> authList <span class="token operator">=</span> authService<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">ResultEntity</span><span class="token punctuation">.</span><span class="token function">successWithData</span><span class="token punctuation">(</span>authList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li><li><p>service</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Auth</span><span class="token punctuation">></span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Auth</span><span class="token punctuation">></span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> authMapper<span class="token punctuation">.</span><span class="token function">selectByExample</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AuthExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li></ol><h3 id="6-3-4-过渡工作二-—-获取角色拥有的权限"><a href="#6-3-4-过渡工作二-—-获取角色拥有的权限" class="headerlink" title="6.3.4 过渡工作二 — 获取角色拥有的权限"></a>6.3.4 过渡工作二 — 获取角色拥有的权限</h3><ol><li><p>创建角色到权限之间的关联表</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> inner_role_auth<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> inner_role_auth
<span class="token punctuation">(</span>
    id <span class="token keyword">INT</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    role_id <span class="token keyword">INT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
    auth_id <span class="token keyword">INT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>handler</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ResponseBody</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/assign/get/assigned/auth/id/by/role/id.do"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token function">getAssignAuthIdByRoleId</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"roleId"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> roleId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> authIdList <span class="token operator">=</span> authService<span class="token punctuation">.</span><span class="token function">getAssignedAuthIdByRoleId</span><span class="token punctuation">(</span>roleId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">ResultEntity</span><span class="token punctuation">.</span><span class="token function">successWithData</span><span class="token punctuation">(</span>authIdList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li><li><p>AuthService</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token function">getAssignedAuthIdByRoleId</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> roleId<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token function">getAssignedAuthIdByRoleId</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> roleId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> authMapper<span class="token punctuation">.</span><span class="token function">selectAssignedAuthIdByRoleId</span><span class="token punctuation">(</span>roleId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li><li><p>AuthMapper</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token function">selectAssignedAuthIdByRoleId</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> roleId<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectAssignedAuthIdByRoleId<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    select auth_id from inner_role_auth where role_id=#&#123;roleId&#125;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre></li><li><p>先在role-page.jsp中配置全局变量<code>window.roleId</code>：</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">// 13.给分配权限按钮绑定单击响应函数</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#rolePageBody"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token string">".checkBtn"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    window<span class="token punctuation">.</span>roleId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span>
    <span class="token operator">...</span></code></pre></li><li><p>my-role.js函数功能实现</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">// e.查询已分配的Auth的id组成的数组</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"window.roleId="</span><span class="token operator">+</span>window<span class="token punctuation">.</span>roleId<span class="token punctuation">)</span>
ajaxReturn <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    url<span class="token operator">:</span> <span class="token string">"assign/get/assigned/auth/id/by/role/id.do"</span><span class="token punctuation">,</span>
    type<span class="token operator">:</span> <span class="token string">"post"</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span><span class="token punctuation">&#123;</span>
        roleId<span class="token operator">:</span> window<span class="token punctuation">.</span>roleId
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    dataType<span class="token operator">:</span> <span class="token string">"json"</span><span class="token punctuation">,</span>
    async<span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>ajaxReturn<span class="token punctuation">.</span>status <span class="token operator">!==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    layer<span class="token punctuation">.</span><span class="token function">msg</span><span class="token punctuation">(</span><span class="token string">" 请 求 处 理 出 错 ！ 响 应 状 态 码 是 ： "</span><span class="token operator">+</span>ajaxReturn<span class="token punctuation">.</span>status<span class="token operator">+</span><span class="token string">" 说 明 是 ："</span><span class="token operator">+</span>ajaxReturn<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 从响应结果中获取 authIdArray</span>
<span class="token keyword">var</span> authIdArray <span class="token operator">=</span> ajaxReturn<span class="token punctuation">.</span>responseJSON<span class="token punctuation">.</span>data<span class="token punctuation">;</span>

<span class="token comment">// f.根据 authIdArray 把树形结构中对应的节点勾选上</span>
<span class="token comment">// ①遍历 authIdArray</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> authIdArray<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> authId <span class="token operator">=</span> authIdArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// ②根据 id 查询树形结构中对应的节点</span>
    <span class="token keyword">var</span> treeNode <span class="token operator">=</span> zTreeObj<span class="token punctuation">.</span><span class="token function">getNodeByParam</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> authId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ③将 treeNode 设置为被勾选</span>
    <span class="token comment">// checked 设置为 true 表示节点勾选</span>
    <span class="token keyword">var</span> checked <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">// checkTypeFlag 设置为 false， 表示不“联动”， 不联动是为了避免把不该勾选的勾选上</span>
    <span class="token keyword">var</span> checkTypeFlag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">// 执行</span>
    zTreeObj<span class="token punctuation">.</span><span class="token function">checkNode</span><span class="token punctuation">(</span>treeNode<span class="token punctuation">,</span> checked<span class="token punctuation">,</span> checkTypeFlag<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li></ol><h3 id="6-3-5-执行分配"><a href="#6-3-5-执行分配" class="headerlink" title="6.3.5 执行分配"></a>6.3.5 执行分配</h3><ol><li><p>给分配权限模态框中的“分配” 按钮绑定单击响应函数：role-page.jsp</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">// 14.给分配权限模态框中的“分配” 按钮绑定单击响应函数</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#assignBtn"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ①收集树形结构的各个节点中被勾选的节点</span>
    <span class="token comment">// [1]声明一个专门的数组存放 id</span>
    <span class="token keyword">var</span> authIdArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// [2]获取 zTreeObj 对象</span>
    <span class="token keyword">var</span> zTreeObj <span class="token operator">=</span> $<span class="token punctuation">.</span>fn<span class="token punctuation">.</span>zTree<span class="token punctuation">.</span><span class="token function">getZTreeObj</span><span class="token punctuation">(</span><span class="token string">"authTreeDemo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// [3]获取全部被勾选的节点</span>
    <span class="token keyword">var</span> checkedNodes <span class="token operator">=</span> zTreeObj<span class="token punctuation">.</span><span class="token function">getCheckedNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// [4]遍历 checkedNodes</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> checkedNodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> checkedNode <span class="token operator">=</span> checkedNodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> authId <span class="token operator">=</span> checkedNode<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
        authIdArray<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>authId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// ②发送请求执行分配</span>
    <span class="token keyword">var</span> requestBody <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token string">"authIdArray"</span><span class="token operator">:</span> authIdArray<span class="token punctuation">,</span>
        <span class="token comment">// 为了服务器端 handler 方法能够统一使用 List&lt;Integer>方式接收数据， roleId 也存入数组</span>
        <span class="token string">"roleId"</span><span class="token operator">:</span> <span class="token punctuation">[</span>window<span class="token punctuation">.</span>roleId<span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    requestBody <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>requestBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        url<span class="token operator">:</span> <span class="token string">"assign/do/role/assign/auth.do"</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">"post"</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> requestBody<span class="token punctuation">,</span>
        contentType<span class="token operator">:</span> <span class="token string">"application/json;charset=UTF-8"</span><span class="token punctuation">,</span>
        dataType<span class="token operator">:</span> <span class="token string">"json"</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">var</span> result <span class="token operator">=</span> response<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">===</span> <span class="token string">"SUCCESS"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                layer<span class="token punctuation">.</span><span class="token function">msg</span><span class="token punctuation">(</span><span class="token string">"操作成功！ "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">if</span>
            <span class="token punctuation">(</span>result <span class="token operator">===</span> <span class="token string">"FAILED"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                layer<span class="token punctuation">.</span><span class="token function">msg</span><span class="token punctuation">(</span><span class="token string">"操作失败！ "</span> <span class="token operator">+</span> response<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            layer<span class="token punctuation">.</span><span class="token function">msg</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> response<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#assignModal"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modal</span><span class="token punctuation">(</span><span class="token string">"hide"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>handler</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ResponseBody</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/assign/do/role/assign/auth.do"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span>  <span class="token function">saveRoleAuthRelathinship</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span><span class="token punctuation">></span></span> map<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    authService<span class="token punctuation">.</span><span class="token function">saveRoleAuthRelationship</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">ResultEntity</span><span class="token punctuation">.</span><span class="token function">successWithoutData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li><li><p>service</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">void</span> <span class="token function">saveRoleAuthRelationship</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span><span class="token punctuation">></span></span> map<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveRoleAuthRelationship</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span><span class="token punctuation">></span></span> map<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">// 1.获取roleId的值</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> roleIdList <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"roleId"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Integer</span> roleId <span class="token operator">=</span> roleIdList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2. 删除旧的关联数据</span>
    authMapper<span class="token punctuation">.</span><span class="token function">deleteOldRelationship</span><span class="token punctuation">(</span>roleId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3.获取 authIdList</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> authIdList <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"authIdArray"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 4.判断 authIdList是否有效</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>authIdList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> authIdList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        authMapper<span class="token punctuation">.</span><span class="token function">insertNewRelationship</span><span class="token punctuation">(</span>roleId<span class="token punctuation">,</span>authIdList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></li><li><p>mapper</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">void</span> <span class="token function">deleteOldRelationship</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> roleId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">insertNewRelationship</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"roleId"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> roleId<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"authIdList"</span><span class="token punctuation">)</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> authIdList<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>delete</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>deleteOldRelationship<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    delete from inner_role_auth where role_id=#&#123;roleId&#125;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>delete</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>insertNewRelationship<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    insert into inner_role_auth(role_id, auth_id) VALUES
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>authIdList<span class="token punctuation">"</span></span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>authId<span class="token punctuation">"</span></span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>,<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>(#&#123;roleId&#125;, #&#123;authId&#125;)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span></code></pre></li></ol><h3 id="6-4-给-Menu-分配-Auth"><a href="#6-4-给-Menu-分配-Auth" class="headerlink" title="6.4 给 Menu 分配 Auth"></a>6.4 给 Menu 分配 Auth</h3><p>与上面类似，本项目中省略</p></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/Java%E7%AC%94%E8%AE%B0/">Java笔记</a> <a class="hover-with-bg" href="/categories/Java%E7%AC%94%E8%AE%B0/%E9%A1%B9%E7%9B%AE/">项目</a> <a class="hover-with-bg" href="/categories/Java%E7%AC%94%E8%AE%B0/%E9%A1%B9%E7%9B%AE/%E5%B0%9A%E7%AD%B9%E7%BD%91/">尚筹网</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/java/">java</a> <a class="hover-with-bg" href="/tags/ssm/">ssm</a></div></div><div class="post-prevnext row"><article class="post-prev col-6"><a href="/posts/3819e182/"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Chapter7后台管理 — SpringSecurity</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/posts/dd32bff4/"><span class="hidden-mobile">Chapter5后台管理 — 菜单维护</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments"><div class="disqus" style="width:100%"><div id="disqus_thread"></div><script>function loadDisqus(){addCssLink("https://cdn.jsdelivr.net/npm/disqusjs@1.0/dist/disqusjs.css"),addScript("https://cdn.jsdelivr.net/npm/disqusjs@1.0/dist/disqus.js",(function(){new DisqusJS({shortname:"Jacob",apikey:""})}))}waitElementVisible("disqus_thread",loadDisqus)</script><noscript>Please enable JavaScript to view the <a target="_blank" href="https://disqus.com/?ref_noscript" rel="nofollow noopener noopener">comments powered by Disqus.</a></noscript></div></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div id="tocbot"></div></div></div></div></div></main><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><footer class="mt-5"><div class="text-center py-3"><div><a href="https://github.com/" target="_blank" rel="nofollow noopener"><span>Github</span></a> <i class="iconfont icon-love"></i> <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a></div><div><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">总访问量 <span id="busuanzi_value_site_pv"></span> 次 </span><span id="busuanzi_container_site_uv" style="display:none">总访客数 <span id="busuanzi_value_site_uv"></span> 人</span></div></div><div><span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span><script>var now=new Date;function createtime(){var n=new Date("10/06/2020 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="本站安全运行&nbsp"+dnum+"&nbsp天",document.getElementById("times").innerHTML=hnum+"&nbsp小时&nbsp"+mnum+"&nbsp分&nbsp"+snum+"&nbsp秒"}setInterval("createtime()",250)</script></div></div></footer><script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script><script src="/js/debouncer.js"></script><script src="/js/main.js"></script><script src="/js/lazyload.js"></script><script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script src="/js/clipboard-use.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js"></script><script>$(document).ready((function(){var t=$("#board-ctn").offset().top;tocbot.init({tocSelector:"#tocbot",contentSelector:"#post-body",headingSelector:"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:3,scrollSmooth:!0,headingsOffset:-t}),$(".toc-list-item").length>0&&$("#toc").css("visibility","visible")}))</script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>var typed=new Typed("#subtitle",{strings:["  ","Chapter6后台管理 — 分配&nbsp;"],cursorChar:"|",typeSpeed:90,loop:!0});typed.stop(),$(document).ready((function(){$(".typed-cursor").addClass("h2"),typed.start()}))</script><script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script><script>anchors.options={placement:"right",visible:"hover"};var el="h1,h2,h3,h4,h5,h6".split(","),res=[];for(item of el)res.push(".markdown-body > "+item);anchors.add(res.join(", "))</script><script src="/js/local-search.js"></script><script>var path="/local-search.xml",inputArea=document.querySelector("#local-search-input");inputArea.onclick=function(){searchFunc(path,"local-search-input","local-search-result"),this.onclick=null}</script><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><script>$("#post img:not(.no-zoom img, img[no-zoom]), img[zoom]").each((function(){var t=document.createElement("a");$(t).attr("data-fancybox","images"),$(t).attr("href",$(this).attr("src")),$(this).wrap(t)}))</script></body></html>